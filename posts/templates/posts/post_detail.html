<!-- templates/posts/post_detail.html -->
{% extends 'base.html' %}

{% block content %}
  <div class="post-detail">
    <h1>{{ post.title }}</h1>
    <p class="post-meta">
      –ê–≤—Ç–æ—Ä: {{ post.author.username }} | –¢–∏–ø: {{ post.get_post_type_display }} |
      {{ post.created_at|date:'d.m.Y H:i' }}
      {% if post.category %}
        | –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ post.category.name }}
      {% endif %}
    </p>

    <div class="post-content">{{ post.content|linebreaks }}</div>

    <div class="post-actions">
      <a href="{% url 'post_list' %}" class="btn">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
      <a href="{% url 'toggle_like' post.id %}" class="btn">
        {% if user.is_authenticated and user_has_liked %}
          üíî –£–±—Ä–∞—Ç—å –ª–∞–π–∫
        {% else %}
          ‚ù§Ô∏è –õ–∞–π–∫
        {% endif %}({{ post.likes.count }})
      </a>
    </div>

    <div class="comments-section">
      <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ post.comments.count }})</h3>

      {% if user.is_authenticated %}
        <form method="post" action="{% url 'add_comment' post.id %}">
          {% csrf_token %}
          <textarea name="content" rows="3" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." required></textarea>
          <button type="submit" class="btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </form>
      {% else %}
        <p>
          –ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, <a href="{% url 'login' %}">–≤–æ–π–¥–∏—Ç–µ</a> –≤ —Å–∏—Å—Ç–µ–º—É.
        </p>
      {% endif %}

      {% for comment in post.comments.all %}
        <div class="comment">
          <p class="comment-meta">
            <strong>{{ comment.author.username }}</strong> -
            {{ comment.created_at|date:'d.m.Y H:i' }}
          </p>
          <p>{{ comment.content }}</p>
        </div>
      {% empty %}
        <p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.</p>
      {% endfor %}
    </div>
  </div>
{% endblock %}
